# ret2_dl_resolve入门

## 0x00 前言

我们知道在**Linux**中如果程序想要调用其他动态链接库的函数，必须要在程序加载的时候动态链接；在一个程序运行过程中，可能很多函数在程序执行完时都不会用到，比如一些错误处理函数或者一些用户很少用到的功能模块；所以ELF采用一种叫做延迟绑定**(Lazy Binding)**的做法，基本思想就是当函数第一次被调用的时候才进行绑定(符号查找、重定位等)；
而在**Linux** 中是利用**_dl_runtime_resolve(link_map_obj, reloc_index)**函数来对动态链接的函数进行重定位的；

首先总的来说一下**_dl_runtime_resolve**函数如何使程序第一次调用一个函数：

1. 首先用**link_map**访问**.dynamic**，分别取出**.dynstr**、 **.dynsym**、 **.rel.plt**的地址；
2. **.rel.plt** + 参数**reloc_index**,求出当前函数的重定位表项**Elf32_Rel**的指针，记作**rel**;
3. **rel->r_info >> 8**作为**.dynsym**的下标，求出当前函数的符号表项**Elf32_Sym**的指针，记作**sym**;
4. .**dynstr + sym->st_name**得出符号名字符串指针;
5. 在动态链接库查找这个函数的地址，并且把地址赋值给***rel->r_offset**，即**GOT**表;
6. 最后调用这个函数；

